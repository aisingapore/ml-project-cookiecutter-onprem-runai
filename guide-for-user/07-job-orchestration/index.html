<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content {{cookiecutter.description}}&quot;&quot;><meta name=author content={{cookiecutter.author_name}}><link href=../06-data-storage-versioning/ rel=prev><link href=../08-deployment/ rel=next><link rel=icon href=../../favicon.svg><meta name=generator content="mkdocs-1.5.2, mkdocs-material-9.2.3"><title>Job Orchestration - {{cookiecutter.project_name}}</title><link rel=stylesheet href=../../assets/stylesheets/main.0e669242.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.85d0ee34.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../termynal.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=aisg data-md-color-primary=red data-md-color-accent=red> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#job-orchestration class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <div data-md-color-scheme=default data-md-component=outdated hidden> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title={{cookiecutter.project_name}} class="md-header__button md-logo" aria-label={{cookiecutter.project_name}} data-md-component=logo> <img src=../../aisg-logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> {{cookiecutter.project_name}} </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Job Orchestration </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=aisg data-md-color-primary=red data-md-color-accent=red aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=red data-md-color-accent=red aria-label="Switch to light mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/aisingapore/ml-project-cookiecutter-onprem-runai title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> aisingapore/ml-project-cookiecutter-onprem-runai </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Home </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../01-prerequisites/ class=md-tabs__link> User Guide </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title={{cookiecutter.project_name}} class="md-nav__button md-logo" aria-label={{cookiecutter.project_name}} data-md-component=logo> <img src=../../aisg-logo.png alt=logo> </a> {{cookiecutter.project_name}} </label> <div class=md-nav__source> <a href=https://github.com/aisingapore/ml-project-cookiecutter-onprem-runai title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> aisingapore/ml-project-cookiecutter-onprem-runai </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2 checked> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> <span class=md-ellipsis> User Guide </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=true> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> User Guide </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../01-prerequisites/ class=md-nav__link> <span class=md-ellipsis> Prerequisites </span> </a> </li> <li class=md-nav__item> <a href=../02-preface/ class=md-nav__link> <span class=md-ellipsis> Preface </span> </a> </li> <li class=md-nav__item> <a href=../03-mlops-components-platform/ class=md-nav__link> <span class=md-ellipsis> MLOps Components & Platform </span> </a> </li> <li class=md-nav__item> <a href=../04-dev-wksp/ class=md-nav__link> <span class=md-ellipsis> Developer Workspace </span> </a> </li> <li class=md-nav__item> <a href=../05-virtual-env/ class=md-nav__link> <span class=md-ellipsis> Virtual Environment </span> </a> </li> <li class=md-nav__item> <a href=../06-data-storage-versioning/ class=md-nav__link> <span class=md-ellipsis> Data Storage & Versioning </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Job Orchestration </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Job Orchestration </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#pipeline-configuration class=md-nav__link> Pipeline Configuration </a> </li> <li class=md-nav__item> <a href=#data-preparation-preprocessing class=md-nav__link> Data Preparation &amp; Preprocessing </a> </li> <li class=md-nav__item> <a href=#model-training class=md-nav__link> Model Training </a> <nav class=md-nav aria-label="Model Training"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#experiment-tracking class=md-nav__link> Experiment Tracking </a> </li> <li class=md-nav__item> <a href=#container-for-experiment-job class=md-nav__link> Container for Experiment Job </a> </li> <li class=md-nav__item> <a href=#hyperparameter-tuning class=md-nav__link> Hyperparameter Tuning </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../08-deployment/ class=md-nav__link> <span class=md-ellipsis> Deployment </span> </a> </li> <li class=md-nav__item> <a href=../09-batch-inferencing/ class=md-nav__link> <span class=md-ellipsis> Batch Inferencing </span> </a> </li> <li class=md-nav__item> <a href=../10-cicd/ class=md-nav__link> <span class=md-ellipsis> CI/CD </span> </a> </li> <li class=md-nav__item> <a href=../11-documentation/ class=md-nav__link> <span class=md-ellipsis> Documentation </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#pipeline-configuration class=md-nav__link> Pipeline Configuration </a> </li> <li class=md-nav__item> <a href=#data-preparation-preprocessing class=md-nav__link> Data Preparation &amp; Preprocessing </a> </li> <li class=md-nav__item> <a href=#model-training class=md-nav__link> Model Training </a> <nav class=md-nav aria-label="Model Training"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#experiment-tracking class=md-nav__link> Experiment Tracking </a> </li> <li class=md-nav__item> <a href=#container-for-experiment-job class=md-nav__link> Container for Experiment Job </a> </li> <li class=md-nav__item> <a href=#hyperparameter-tuning class=md-nav__link> Hyperparameter Tuning </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=job-orchestration>Job Orchestration<a class=headerlink href=#job-orchestration title="Permanent link">&para;</a></h1> <p>Even though we can set up development workspaces to execute jobs and workflows, these environments often have limited access to resources. To carry out heavier workloads, we encourage the usage of job orchestration features that Run:ai offers.</p> <p>Jobs are submitted to the Kubernetes cluster through Run:ai and executed within Docker containers. Using the images specified upon job submission, Kubernetes pods are spun up to execute the entry points or commands defined, tapping on to the cluster's available resources.</p> <p>Any jobs that are submitted to Run:ai can be tracked and monitored through Run:ai's dashboard.</p> <h2 id=pipeline-configuration>Pipeline Configuration<a class=headerlink href=#pipeline-configuration title="Permanent link">&para;</a></h2> <p>In this template, Hydra is the configuration framework of choice for the data preparation and model training pipelines (or any pipelines that doesn't belong to the model serving aspects).</p> <p>The configurations for logging, pipelines and hyperparameter tuning can be found under <code>conf/base</code>. These YAML files are then referred to by Hydra or general utility functions (<code>src/{{cookiecutter.src_package_name}}/general_utils.py</code>) for loading of parameters and configurations. The defined default values can be overridden through the CLI.</p> <div class="admonition attention"> <p class=admonition-title>Attention</p> <p>It is recommended that you have a basic understanding of <a href=https://hydra.cc/ >Hydra</a>'s concepts before you move on.</p> </div> <p><strong>Reference(s):</strong></p> <ul> <li><a href=https://hydra.cc/docs/advanced/override_grammar/basic/ >Hydra Docs - Basic Override Syntax</a></li> </ul> <h2 id=data-preparation-preprocessing>Data Preparation &amp; Preprocessing<a class=headerlink href=#data-preparation-preprocessing title="Permanent link">&para;</a></h2> <p>To process the sample raw data, we will be spinning up a job on Run:ai, using the CLI. This job will be using a Docker image that will be built from a Dockerfile (<code>docker/{{cookiecutter.src_package_name}}-data-prep.Dockerfile</code>) provided in this template:</p> <div class="tabbed-set tabbed-alternate" data-tabs=1:2><input checked=checked id=__tabbed_1_1 name=__tabbed_1 type=radio><input id=__tabbed_1_2 name=__tabbed_1 type=radio><div class=tabbed-labels><label for=__tabbed_1_1>Linux/macOS</label><label for=__tabbed_1_2>Windows PowerShell</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>$<span class=w> </span>docker<span class=w> </span>build<span class=w> </span><span class=se>\</span>
<span class=w>    </span>-t<span class=w> </span><span class=o>{{</span>cookiecutter.harbor_registry_project_path<span class=o>}}</span>/data-prep:0.1.0<span class=w> </span><span class=se>\</span>
<span class=w>    </span>-f<span class=w> </span>docker/<span class=o>{{</span>cookiecutter.repo_name<span class=o>}}</span>-data-prep.Dockerfile<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--platform<span class=w> </span>linux/amd64<span class=w> </span>.
$<span class=w> </span>docker<span class=w> </span>push<span class=w> </span><span class=o>{{</span>cookiecutter.harbor_registry_project_path<span class=o>}}</span>/data-prep:0.1.0
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=p>$</span> <span class=n>docker</span> <span class=n>build</span> <span class=p>`</span>
    <span class=n>-t</span> <span class=p>{{</span><span class=n>cookiecutter</span><span class=p>.</span><span class=n>harbor_registry_project_path</span><span class=p>}}/</span><span class=n>data-prep</span><span class=p>:</span><span class=n>0</span><span class=p>.</span><span class=n>1</span><span class=p>.</span><span class=n>0</span> <span class=p>`</span>
    <span class=o>-f</span> <span class=n>docker</span><span class=p>/{{</span><span class=n>cookiecutter</span><span class=p>.</span><span class=n>repo_name</span><span class=p>}}</span><span class=n>-data-prep</span><span class=p>.</span><span class=n>Dockerfile</span> <span class=p>`</span>
    <span class=p>-</span><span class=n>-platform</span> <span class=n>linux</span><span class=p>/</span><span class=n>amd64</span> <span class=p>.</span>
<span class=p>$</span> <span class=n>docker</span> <span class=n>push</span> <span class=p>{{</span><span class=n>cookiecutter</span><span class=p>.</span><span class=n>harbor_registry_project_path</span><span class=p>}}/</span><span class=n>data-prep</span><span class=p>:</span><span class=n>0</span><span class=p>.</span><span class=n>1</span><span class=p>.</span><span class=n>0</span>
</code></pre></div> </div> </div> </div> <p>Now that we have the Docker image pushed to the registry, we can submit a job using that image to Run:ai:</p> <div class="tabbed-set tabbed-alternate" data-tabs=2:2><input checked=checked id=__tabbed_2_1 name=__tabbed_2 type=radio><input id=__tabbed_2_2 name=__tabbed_2 type=radio><div class=tabbed-labels><label for=__tabbed_2_1>Linux/macOS</label><label for=__tabbed_2_2>Windows PowerShell</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>$<span class=w> </span>runai<span class=w> </span>submit<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--job-name-prefix<span class=w> </span>&lt;YOUR_HYPHENATED_NAME&gt;-data-prep<span class=w> </span><span class=se>\</span>
<span class=w>    </span>-i<span class=w> </span><span class=o>{{</span>cookiecutter.harbor_registry_project_path<span class=o>}}</span>/data-prep:0.1.0<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--working-dir<span class=w> </span>/&lt;NAME_OF_DATA_SOURCE&gt;/workspaces/&lt;YOUR_HYPHENATED_NAME&gt;/<span class=o>{{</span>cookiecutter.repo_name<span class=o>}}</span><span class=w> </span><span class=se>\</span>
<span class=w>    </span>--pvc<span class=w> </span>&lt;NAME_OF_DATA_SOURCE&gt;:/&lt;NAME_OF_DATA_SOURCE&gt;<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--cpu<span class=w> </span><span class=m>2</span><span class=w> </span><span class=se>\</span>
<span class=w>    </span>--memory<span class=w> </span>4G<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--command<span class=w> </span>--<span class=w> </span><span class=s1>&#39;/bin/bash -c &quot;source activate {{cookiecutter.repo_name}} &amp;&amp; python src/process_data.py process_data.raw_data_dir_path=/&lt;NAME_OF_DATA_SOURCE&gt;/workspaces/&lt;YOUR_HYPHENATED_NAME&gt;/data/mnist-pngs-data-aisg process_data.processed_data_dir_path=/&lt;NAME_OF_DATA_SOURCE&gt;/workspaces/&lt;YOUR_HYPHENATED_NAME&gt;/data/processed/mnist-pngs-data-aisg-processed&quot;&#39;</span>
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=p>$</span> <span class=n>runai</span> <span class=n>submit</span> <span class=p>`</span>
    <span class=p>-</span><span class=n>-job-name-prefix</span> <span class=p>&lt;</span><span class=n>YOUR_HYPHENATED_NAME</span><span class=p>&gt;</span><span class=n>-data-prep</span> <span class=p>`</span>
    <span class=n>-i</span> <span class=p>{{</span><span class=n>cookiecutter</span><span class=p>.</span><span class=n>harbor_registry_project_path</span><span class=p>}}/</span><span class=n>data-prep</span><span class=p>:</span><span class=n>0</span><span class=p>.</span><span class=n>1</span><span class=p>.</span><span class=n>0</span> <span class=p>`</span>
    <span class=p>-</span><span class=n>-working-dir</span> <span class=p>/&lt;</span><span class=n>NAME_OF_DATA_SOURCE</span><span class=p>&gt;/</span><span class=n>workspaces</span><span class=p>/&lt;</span><span class=n>YOUR_HYPHENATED_NAME</span><span class=p>&gt;/{{</span><span class=n>cookiecutter</span><span class=p>.</span><span class=n>repo_name</span><span class=p>}}</span> <span class=p>`</span>
    <span class=p>-</span><span class=n>-pvc</span> <span class=p>&lt;</span><span class=n>NAME_OF_DATA_SOURCE</span><span class=p>&gt;:/&lt;</span><span class=n>NAME_OF_DATA_SOURCE</span><span class=p>&gt;</span> <span class=p>`</span>
    <span class=p>-</span><span class=n>-cpu</span> <span class=n>2</span> <span class=p>`</span>
    <span class=p>-</span><span class=n>-memory</span> <span class=n>4G</span> <span class=p>`</span>
    <span class=p>-</span><span class=n>-command</span> <span class=p>--</span> <span class=s2>&quot;/bin/bash -c &#39;source activate {{cookiecutter.repo_name}} &amp;&amp; python src/process_data.py process_data.raw_data_dir_path=/&lt;NAME_OF_DATA_SOURCE&gt;/workspaces/&lt;YOUR_HYPHENATED_NAME&gt;/data/mnist-pngs-data-aisg process_data.processed_data_dir_path=/&lt;NAME_OF_DATA_SOURCE&gt;/workspaces/&lt;YOUR_HYPHENATED_NAME&gt;/data/processed/mnist-pngs-data-aisg-processed&#39;&quot;</span>
</code></pre></div> </div> </div> </div> <p>After some time, the data processing job should conclude and we can proceed with training the predictive model. The processed data is exported to the directory <code>/&lt;NAME_OF_DATA_SOURCE&gt;/workspaces/&lt;YOUR_HYPHENATED_NAME&gt;/data/processed/mnist-pngs-data-aisg-processed</code>. We will be passing this path to the model training workflows.</p> <h2 id=model-training>Model Training<a class=headerlink href=#model-training title="Permanent link">&para;</a></h2> <p>Now that we have processed the raw data, we can look into training the sentiment classification model. The script relevant for this section is <code>src/train_model.py</code>. In this script, you can see it using some utility functions from <code>src/{{cookiecutter.src_package_name}}/general_utils.py</code> as well, most notably the functions for utilising MLflow utilities for tracking experiments. Let's set up the tooling for experiment tracking before we start model experimentation.</p> <h3 id=experiment-tracking>Experiment Tracking<a class=headerlink href=#experiment-tracking title="Permanent link">&para;</a></h3> <p>In the module <code>src/{{cookiecutter.src_package_name}}/general_utils.py</code>, the functions <code>mlflow_init</code> and <code>mlflow_log</code> are used to initialise MLflow experiments as well as log information and artifacts relevant for a run to a remote MLflow Tracking server. An MLflow Tracking server is usually set up within the Run:ai project's namespace for projects that requires model experimentation. Artifacts logged through the MLflow API can be uploaded to ECS buckets, assuming the client is authorised for access to ECS.</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>The username and password for the MLflow Tracking server can be retrieved from the MLOps team or your team lead.</p> </div> <p>To log and upload artifacts to ECS buckets through MLflow, you need to ensure that the client has access to the credentials of an account that can write to a bucket.</p> <p><strong>Reference(s):</strong></p> <ul> <li><a href=https://www.mlflow.org/docs/latest/tracking.html#>MLflow Docs - Tracking</a></li> <li><a href=https://www.mlflow.org/docs/latest/tracking.html#artifact-stores>MLflow Docs - Tracking (Artifact Stores)</a></li> </ul> <h3 id=container-for-experiment-job>Container for Experiment Job<a class=headerlink href=#container-for-experiment-job title="Permanent link">&para;</a></h3> <p>Before we submit a job to Run:ai to train our model, we need to build the Docker image to be used for it:</p> <div class="tabbed-set tabbed-alternate" data-tabs=3:2><input checked=checked id=__tabbed_3_1 name=__tabbed_3 type=radio><input id=__tabbed_3_2 name=__tabbed_3 type=radio><div class=tabbed-labels><label for=__tabbed_3_1>Linux/macOS</label><label for=__tabbed_3_2>Windows PowerShell</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>$<span class=w> </span>docker<span class=w> </span>build<span class=w> </span><span class=se>\</span>
<span class=w>    </span>-t<span class=w> </span><span class=o>{{</span>cookiecutter.harbor_registry_project_path<span class=o>}}</span>/model-training:0.1.0<span class=w> </span><span class=se>\</span>
<span class=w>    </span>-f<span class=w> </span>docker/<span class=o>{{</span>cookiecutter.repo_name<span class=o>}}</span>-model-training.Dockerfile<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--platform<span class=w> </span>linux/amd64<span class=w> </span>.
$<span class=w> </span>docker<span class=w> </span>push<span class=w> </span><span class=o>{{</span>cookiecutter.harbor_registry_project_path<span class=o>}}</span>/model-training:0.1.0
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=p>$</span> <span class=n>docker</span> <span class=n>build</span> <span class=p>`</span>
    <span class=n>-t</span> <span class=p>{{</span><span class=n>cookiecutter</span><span class=p>.</span><span class=n>harbor_registry_project_path</span><span class=p>}}/</span><span class=n>model-training</span><span class=p>:</span><span class=n>0</span><span class=p>.</span><span class=n>1</span><span class=p>.</span><span class=n>0</span> <span class=p>`</span>
    <span class=o>-f</span> <span class=n>docker</span><span class=p>/{{</span><span class=n>cookiecutter</span><span class=p>.</span><span class=n>repo_name</span><span class=p>}}</span><span class=n>-model-training</span><span class=p>.</span><span class=n>Dockerfile</span> <span class=p>`</span>
    <span class=p>-</span><span class=n>-platform</span> <span class=n>linux</span><span class=p>/</span><span class=n>amd64</span> <span class=p>.</span>
<span class=p>$</span> <span class=n>docker</span> <span class=n>push</span> <span class=p>{{</span><span class=n>cookiecutter</span><span class=p>.</span><span class=n>harbor_registry_project_path</span><span class=p>}}/</span><span class=n>model-training</span><span class=p>:</span><span class=n>0</span><span class=p>.</span><span class=n>1</span><span class=p>.</span><span class=n>0</span>
</code></pre></div> </div> </div> </div> <p>Now that we have the Docker image pushed to the registry, we can run a job using it:</p> <div class="tabbed-set tabbed-alternate" data-tabs=4:2><input checked=checked id=__tabbed_4_1 name=__tabbed_4 type=radio><input id=__tabbed_4_2 name=__tabbed_4 type=radio><div class=tabbed-labels><label for=__tabbed_4_1>Linux/macOS</label><label for=__tabbed_4_2>Windows PowerShell</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>$<span class=w> </span>runai<span class=w> </span>submit<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--job-name-prefix<span class=w> </span>&lt;YOUR_HYPHENATED_NAME&gt;-train<span class=w> </span><span class=se>\</span>
<span class=w>    </span>-i<span class=w> </span><span class=o>{{</span>cookiecutter.harbor_registry_project_path<span class=o>}}</span>/model-training:0.1.0<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--working-dir<span class=w> </span>/home/aisg/<span class=o>{{</span>cookiecutter.repo_name<span class=o>}}</span><span class=w> </span><span class=se>\</span>
<span class=w>    </span>--pvc<span class=w> </span>&lt;NAME_OF_DATA_SOURCE&gt;:/&lt;NAME_OF_DATA_SOURCE&gt;<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--cpu<span class=w> </span><span class=m>2</span><span class=w> </span><span class=se>\</span>
<span class=w>    </span>--memory<span class=w> </span>4G<span class=w> </span><span class=se>\</span>
<span class=w>    </span>-e<span class=w> </span><span class=nv>AWS_ACCESS_KEY_ID</span><span class=o>=</span>SECRET:s3-credentials,accessKeyId<span class=w> </span><span class=se>\</span>
<span class=w>    </span>-e<span class=w> </span><span class=nv>AWS_SECRET_ACCESS_KEY</span><span class=o>=</span>SECRET:s3-credentials,secretAccessKey<span class=w> </span><span class=se>\</span>
<span class=w>    </span>-e<span class=w> </span><span class=nv>MLFLOW_S3_ENDPOINT_URL</span><span class=o>=</span><span class=s2>&quot;https://necs.nus.edu.sg&quot;</span><span class=w> </span><span class=se>\</span>
<span class=w>    </span>-e<span class=w> </span><span class=nv>MLFLOW_TRACKING_USERNAME</span><span class=o>=</span>&lt;YOUR_MLFLOW_USERNAME&gt;<span class=w> </span><span class=se>\</span>
<span class=w>    </span>-e<span class=w> </span><span class=nv>MLFLOW_TRACKING_PASSWORD</span><span class=o>=</span>&lt;YOUR_MLFLOW_PASSWORD&gt;<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--command<span class=w> </span>--<span class=w> </span><span class=s1>&#39;/bin/bash -c &quot;source activate {{cookiecutter.repo_name}} &amp;&amp; python src/train_model.py train_model.data_dir_path=/&lt;NAME_OF_DATA_SOURCE&gt;/workspaces/&lt;YOUR_HYPHENATED_NAME&gt;/data/processed/mnist-pngs-data-aisg-processed train_model.setup_mlflow=true train_model.mlflow_tracking_uri=&lt;MLFLOW_TRACKING_URI&gt; train_model.mlflow_exp_name=&lt;NAME_OF_DEFAULT_MLFLOW_EXPERIMENT&gt; train_model.model_checkpoint_dir_path=/&lt;NAME_OF_DATA_SOURCE&gt;/workspaces/&lt;YOUR_HYPHENATED_NAME&gt;/{{cookiecutter.repo_name}}/models train_model.epochs=3&quot;&#39;</span>
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=p>$</span> <span class=n>runai</span> <span class=n>submit</span> <span class=p>`</span>
    <span class=p>-</span><span class=n>-job-name-prefix</span> <span class=p>&lt;</span><span class=n>YOUR_HYPHENATED_NAME</span><span class=p>&gt;</span><span class=n>-train</span> <span class=p>`</span>
    <span class=n>-i</span> <span class=p>{{</span><span class=n>cookiecutter</span><span class=p>.</span><span class=n>harbor_registry_project_path</span><span class=p>}}/</span><span class=n>model-training</span><span class=p>:</span><span class=n>0</span><span class=p>.</span><span class=n>1</span><span class=p>.</span><span class=n>0</span> <span class=p>`</span>
    <span class=p>-</span><span class=n>-working-dir</span> <span class=p>/</span><span class=n>home</span><span class=p>/</span><span class=n>aisg</span><span class=p>/{{</span><span class=n>cookiecutter</span><span class=p>.</span><span class=n>repo_name</span><span class=p>}}</span> <span class=p>`</span>
    <span class=p>-</span><span class=n>-pvc</span> <span class=p>&lt;</span><span class=n>NAME_OF_DATA_SOURCE</span><span class=p>&gt;:/&lt;</span><span class=n>NAME_OF_DATA_SOURCE</span><span class=p>&gt;</span> <span class=p>`</span>
    <span class=p>-</span><span class=n>-cpu</span> <span class=n>2</span> <span class=p>`</span>
    <span class=p>-</span><span class=n>-memory</span> <span class=n>4G</span> <span class=p>`</span>
    <span class=n>-e</span> <span class=n>AWS_ACCESS_KEY_ID</span><span class=p>=</span><span class=n>SECRET</span><span class=p>:</span><span class=n>s3-credentials</span><span class=p>,</span><span class=n>accessKeyId</span> <span class=p>`</span>
    <span class=n>-e</span> <span class=n>AWS_SECRET_ACCESS_KEY</span><span class=p>=</span><span class=n>SECRET</span><span class=p>:</span><span class=n>s3-credentials</span><span class=p>,</span><span class=n>secretAccessKey</span> <span class=p>`</span>
    <span class=n>-e</span> <span class=n>MLFLOW_S3_ENDPOINT_URL</span><span class=p>=</span><span class=s2>&quot;https://necs.nus.edu.sg&quot;</span> <span class=p>`</span>
    <span class=n>-e</span> <span class=n>MLFLOW_TRACKING_USERNAME</span><span class=p>=&lt;</span><span class=n>YOUR_MLFLOW_USERNAME</span><span class=p>&gt;</span> <span class=p>`</span>
    <span class=n>-e</span> <span class=n>MLFLOW_TRACKING_PASSWORD</span><span class=p>=&lt;</span><span class=n>YOUR_MLFLOW_PASSWORD</span><span class=p>&gt;</span> <span class=p>`</span>
    <span class=p>-</span><span class=n>-command</span> <span class=p>--</span> <span class=s2>&quot;/bin/bash -c &#39;source activate {{cookiecutter.repo_name}} &amp;&amp; python src/train_model.py train_model.data_dir_path=/&lt;NAME_OF_DATA_SOURCE&gt;/workspaces/&lt;YOUR_HYPHENATED_NAME&gt;/data/processed/mnist-pngs-data-aisg-processed train_model.setup_mlflow=true train_model.mlflow_tracking_uri=&lt;MLFLOW_TRACKING_URI&gt; train_model.mlflow_exp_name=&lt;NAME_OF_DEFAULT_MLFLOW_EXPERIMENT&gt; train_model.model_checkpoint_dir_path=/&lt;NAME_OF_DATA_SOURCE&gt;/workspaces/&lt;YOUR_HYPHENATED_NAME&gt;/{{cookiecutter.repo_name}}/models train_model.epochs=3&#39;&quot;</span>
</code></pre></div> </div> </div> </div> <p>Once you have successfully run an experiment, you may inspect the run on the MLflow Tracking server. Through the MLflow Tracking server interface, you can view the metrics and parameters logged for the run, as well as download the artifacts that have been uploaded to the ECS bucket. You can also compare runs with each other.</p> <p><img alt="MLflow Tracking Server - Inspecting Runs" src=https://storage.googleapis.com/aisg-mlops-pub-data/images/mlflow-tracking-server-inspect.gif></p> <div class="admonition tip"> <p class=admonition-title>Tip</p> <p>Every job submitted with <code>runai submit</code> is assigned a unique ID, and a unique job name if the <code>--job-name-prefix</code> is used. The <code>mlflow_init</code> function within the <code>general_utils.py</code> module tags every experiment name with the job's name and UUID as provided by Run:ai, with the tags <code>job_uuid</code> and <code>job_name</code>. This allows you to easily identify the MLflow experiment runs that are associated with each Run:ai job. You can filter for MLflow experiment runs associated with a specific Run:ai job by using MLflow's search filter expressions and API.</p> <p><strong>Reference(s):</strong></p> <ul> <li><a href=https://docs.run.ai/v2.9/Researcher/best-practices/env-variables/ >Run:ai Docs - Environment Variables inside a Run:ai Workload</a></li> <li><a href=https://mlflow.org/docs/latest/search-runs.html>MLflow Docs - Search Runs</a></li> </ul> </div> <div class="admonition info"> <p class=admonition-title>Info</p> <p>If your project has GPU quotas assigned to it, you can make use of it by specifying the <code>--gpu</code> flag in the <code>runai submit</code> command. As part of Run:ai's unique selling point, you can also specify fractional values, which would allow you to utilise a fraction of a GPU. This is useful for projects that require a GPU for training, but do not require the full capacity of a GPU.</p> </div> <h3 id=hyperparameter-tuning>Hyperparameter Tuning<a class=headerlink href=#hyperparameter-tuning title="Permanent link">&para;</a></h3> <p>For many ML problems, we would be bothered with finding the optimal parameters to train our models with. While we are able to override the parameters for our model training workflows, imagine having to sweep through a distribution of values. For example, if you were to seek for the optimal learning rate within a log space, we would have to execute <code>runai submit</code> a myriad of times manually, just to provide the training script with a different learning rate value each time. It is reasonable that one seeks for ways to automate this workflow.</p> <p><a href=https://optuna.readthedocs.io/en/stable/ >Optuna</a> is an optimisation framework designed for ML use-cases. Its features includes:</p> <ul> <li>ease of modularity,</li> <li>optimisation algorithms for searching the best set of parameters,</li> <li>and <a href=https://optuna.readthedocs.io/en/stable/tutorial/10_key_features/004_distributed.html>paralellisation</a> capabilities for faster sweeps.</li> </ul> <p>In addition, Hydra has a plugin for utilising Optuna which further translates to ease of configuration. To use Hydra's plugin for Optuna, we have to provide further overrides within the YAML config, and this is observed in <code>conf/base/pipelines.yaml</code>:</p> <div class=highlight><pre><span></span><code><span class=nt>defaults</span><span class=p>:</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>override hydra/sweeper</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">optuna</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>override hydra/sweeper/sampler</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">tpe</span>

<span class=nt>hydra</span><span class=p>:</span>
<span class=w>  </span><span class=nt>sweeper</span><span class=p>:</span>
<span class=w>    </span><span class=nt>sampler</span><span class=p>:</span>
<span class=w>      </span><span class=nt>seed</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">55</span>
<span class=w>    </span><span class=nt>direction</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;minimize&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;maximize&quot;</span><span class="p p-Indicator">]</span>
<span class=w>    </span><span class=nt>study_name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;image-classification&quot;</span>
<span class=w>    </span><span class=nt>storage</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
<span class=w>    </span><span class=nt>n_trials</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<span class=w>    </span><span class=nt>n_jobs</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class=w>    </span><span class=nt>params</span><span class=p>:</span>
<span class=w>      </span><span class=nt>train_model.lr</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">range(0.9,1.7,step=0.1)</span>
<span class=w>      </span><span class=nt>train_model.gamma</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">choice(0.7,0.8,0.9)</span>
</code></pre></div> <p>These fields are used by the Optuna Sweeper plugin to configure the Optuna study.</p> <div class="admonition attention"> <p class=admonition-title>Attention</p> <p>The fields defined are terminologies used by Optuna. Therefore, it is recommended that you understand the basics of the tool. <a href="https://www.youtube.com/watch?v=P6NwZVl8ttc">This overview video</a> covers well on the concepts brought upon by Optuna.</p> <p>Here are the definitions for some of the fields:</p> <ul> <li><code>params</code> is used to specify the parameters to be tuned, and the values to be searched through</li> <li><code>n_trials</code> specifies the number of trials to be executed</li> <li><code>n_jobs</code> specifies the number of trials to be executed in parallel</li> </ul> </div> <p>As to how the training script would work towards training a model with the best set of parameters, there are two important lines from two different files that we have to pay attention to.</p> <p><code>src/train_model.py</code></p> <div class=highlight><pre><span></span><code><span class=o>...</span>
    <span class=k>return</span> <span class=n>curr_test_loss</span><span class=p>,</span> <span class=n>curr_test_accuracy</span>
<span class=o>...</span>
</code></pre></div> <p><code>conf/base/pipelines.yaml</code></p> <div class=highlight><pre><span></span><code><span class=nn>...</span>
<span class=w>    </span><span class=nt>direction</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;minimize&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;maximize&quot;</span><span class="p p-Indicator">]</span>
<span class=nn>...</span>
</code></pre></div> <p>In the training script the returned variables are to contain values that we seek to optimise for. In this case, we seek to minimise the loss and maximise the accuracy. The <code>hydra.sweeper.direction</code> field in the YAML config is used to specify the direction that those variables are to optimise towards, defined in a positional manner within a list.</p> <p>An additional thing to take note of is that for each trial where a different set of parameters are concerned, a new MLflow run has to be initialised. However, we need to somehow link all these different runs together so that we can compare all the runs within a single Optuna study (set of trials). How we do this is that we provide each trial with the same tag to be logged to MLflow (<code>hptuning_tag</code>) which would essentially be the date epoch value of the moment you submitted the job to Run:ai. This tag is defined using the environment value <code>MLFLOW_HPTUNING_TAG</code>. This tag is especially useful if you are executing the model training job out of the Run:ai platform, as the <code>JOB_NAME</code> and <code>JOB_UUID</code> environment variables would not be available by default.</p> <div class="tabbed-set tabbed-alternate" data-tabs=5:2><input checked=checked id=__tabbed_5_1 name=__tabbed_5 type=radio><input id=__tabbed_5_2 name=__tabbed_5 type=radio><div class=tabbed-labels><label for=__tabbed_5_1>Linux/macOS</label><label for=__tabbed_5_2>Windows PowerShell</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>$<span class=w> </span>runai<span class=w> </span>submit<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--job-name-prefix<span class=w> </span>&lt;YOUR_HYPHENATED_NAME&gt;-train<span class=w> </span><span class=se>\</span>
<span class=w>    </span>-i<span class=w> </span><span class=o>{{</span>cookiecutter.harbor_registry_project_path<span class=o>}}</span>/model-training:0.1.0<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--working-dir<span class=w> </span>/home/aisg/<span class=o>{{</span>cookiecutter.repo_name<span class=o>}}</span><span class=w> </span><span class=se>\</span>
<span class=w>    </span>--pvc<span class=w> </span>&lt;NAME_OF_DATA_SOURCE&gt;:/&lt;NAME_OF_DATA_SOURCE&gt;<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--cpu<span class=w> </span><span class=m>2</span><span class=w> </span><span class=se>\</span>
<span class=w>    </span>--memory<span class=w> </span>4G<span class=w> </span><span class=se>\</span>
<span class=w>    </span>-e<span class=w> </span><span class=nv>AWS_ACCESS_KEY_ID</span><span class=o>=</span>SECRET:s3-credentials,accessKeyId<span class=w> </span><span class=se>\</span>
<span class=w>    </span>-e<span class=w> </span><span class=nv>AWS_SECRET_ACCESS_KEY</span><span class=o>=</span>SECRET:s3-credentials,secretAccessKey<span class=w> </span><span class=se>\</span>
<span class=w>    </span>-e<span class=w> </span><span class=nv>MLFLOW_S3_ENDPOINT_URL</span><span class=o>=</span><span class=s2>&quot;https://necs.nus.edu.sg&quot;</span><span class=w> </span><span class=se>\</span>
<span class=w>    </span>-e<span class=w> </span><span class=nv>MLFLOW_TRACKING_USERNAME</span><span class=o>=</span>&lt;YOUR_MLFLOW_USERNAME&gt;<span class=w> </span><span class=se>\</span>
<span class=w>    </span>-e<span class=w> </span><span class=nv>MLFLOW_TRACKING_PASSWORD</span><span class=o>=</span>&lt;YOUR_MLFLOW_PASSWORD&gt;<span class=w> </span><span class=se>\</span>
<span class=w>    </span>-e<span class=w> </span><span class=nv>MLFLOW_HPTUNING_TAG</span><span class=o>=</span><span class=k>$(</span>date<span class=w> </span>+%s<span class=k>)</span><span class=w> </span><span class=se>\</span>
<span class=w>    </span>--command<span class=w> </span>--<span class=w> </span><span class=s1>&#39;/bin/bash -c &quot;source activate {{cookiecutter.repo_name}} &amp;&amp; python src/train_model.py --multirun train_model.data_dir_path=/&lt;NAME_OF_DATA_SOURCE&gt;/workspaces/&lt;YOUR_HYPHENATED_NAME&gt;/data/processed/mnist-pngs-data-aisg-processed train_model.setup_mlflow=true train_model.mlflow_tracking_uri=&lt;MLFLOW_TRACKING_URI&gt; train_model.mlflow_exp_name=&lt;NAME_OF_DEFAULT_MLFLOW_EXPERIMENT&gt; train_model.model_checkpoint_dir_path=/&lt;NAME_OF_DATA_SOURCE&gt;/workspaces/&lt;YOUR_HYPHENATED_NAME&gt;/{{cookiecutter.repo_name}}/models train_model.epochs=3&quot;&#39;</span>
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=p>$</span> <span class=n>runai</span> <span class=n>submit</span> <span class=p>`</span>
    <span class=p>-</span><span class=n>-job-name-prefix</span> <span class=p>&lt;</span><span class=n>YOUR_HYPHENATED_NAME</span><span class=p>&gt;</span><span class=n>-train</span> <span class=p>`</span>
    <span class=n>-i</span> <span class=p>{{</span><span class=n>cookiecutter</span><span class=p>.</span><span class=n>harbor_registry_project_path</span><span class=p>}}/</span><span class=n>model-training</span><span class=p>:</span><span class=n>0</span><span class=p>.</span><span class=n>1</span><span class=p>.</span><span class=n>0</span> <span class=p>`</span>
    <span class=p>-</span><span class=n>-working-dir</span> <span class=p>/</span><span class=n>home</span><span class=p>/</span><span class=n>aisg</span><span class=p>/{{</span><span class=n>cookiecutter</span><span class=p>.</span><span class=n>repo_name</span><span class=p>}}</span> <span class=p>`</span>
    <span class=p>-</span><span class=n>-pvc</span> <span class=p>&lt;</span><span class=n>NAME_OF_DATA_SOURCE</span><span class=p>&gt;:/&lt;</span><span class=n>NAME_OF_DATA_SOURCE</span><span class=p>&gt;</span> <span class=p>`</span>
    <span class=p>-</span><span class=n>-cpu</span> <span class=n>2</span> <span class=p>`</span>
    <span class=p>-</span><span class=n>-memory</span> <span class=n>4G</span> <span class=p>`</span>
    <span class=n>-e</span> <span class=n>AWS_ACCESS_KEY_ID</span><span class=p>=</span><span class=n>SECRET</span><span class=p>:</span><span class=n>s3-credentials</span><span class=p>,</span><span class=n>accessKeyId</span> <span class=p>`</span>
    <span class=n>-e</span> <span class=n>AWS_SECRET_ACCESS_KEY</span><span class=p>=</span><span class=n>SECRET</span><span class=p>:</span><span class=n>s3-credentials</span><span class=p>,</span><span class=n>secretAccessKey</span> <span class=p>`</span>
    <span class=n>-e</span> <span class=n>MLFLOW_S3_ENDPOINT_URL</span><span class=p>=</span><span class=s2>&quot;https://necs.nus.edu.sg&quot;</span> <span class=p>`</span>
    <span class=n>-e</span> <span class=n>MLFLOW_TRACKING_USERNAME</span><span class=p>=&lt;</span><span class=n>YOUR_MLFLOW_USERNAME</span><span class=p>&gt;</span> <span class=p>`</span>
    <span class=n>-e</span> <span class=n>MLFLOW_TRACKING_PASSWORD</span><span class=p>=&lt;</span><span class=n>YOUR_MLFLOW_PASSWORD</span><span class=p>&gt;</span> <span class=p>`</span>
    <span class=n>-e</span> <span class=n>MLFLOW_HPTUNING_TAG</span><span class=p>=$(</span><span class=nb>Get-Date</span> <span class=n>-UFormat</span> <span class=k>%</span><span class=n>s</span> <span class=n>-Millisecond</span> <span class=n>0</span><span class=p>)</span> <span class=p>`</span>
    <span class=p>-</span><span class=n>-command</span> <span class=p>--</span> <span class=s2>&quot;/bin/bash -c &#39;source activate {{cookiecutter.repo_name}} &amp;&amp; python src/train_model.py --multirun train_model.data_dir_path=/&lt;NAME_OF_DATA_SOURCE&gt;/workspaces/&lt;YOUR_HYPHENATED_NAME&gt;/data/processed/mnist-pngs-data-aisg-processed train_model.setup_mlflow=true train_model.mlflow_tracking_uri=&lt;MLFLOW_TRACKING_URI&gt; train_model.mlflow_exp_name=&lt;NAME_OF_DEFAULT_MLFLOW_EXPERIMENT&gt; train_model.model_checkpoint_dir_path=/&lt;NAME_OF_DATA_SOURCE&gt;/workspaces/&lt;YOUR_HYPHENATED_NAME&gt;/{{cookiecutter.repo_name}}/models train_model.epochs=3&#39;&quot;</span>
</code></pre></div> </div> </div> </div> <p><img alt="MLflow Tracking Server - Hyperparameter Tuning Runs" src=../assets/screenshots/mlflow-tracking-hptuning-runs.png></p> <p><strong>Reference(s):</strong></p> <ul> <li><a href=https://docs.run.ai/v2.9/Researcher/best-practices/env-variables/ >Run:ai Docs - Environment Variables inside a Run:ai Workload</a></li> <li><a href=https://hydra.cc/docs/plugins/optuna_sweeper/ >Hydra Docs - Optuna Sweeper Plugin</a></li> <li><a href=https://www.mlflow.org/docs/latest/search-syntax.html>MLflow Docs - Search Syntax</a></li> </ul> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../06-data-storage-versioning/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Data Storage & Versioning" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> Data Storage & Versioning </div> </div> </a> <a href=../08-deployment/ class="md-footer__link md-footer__link--next" aria-label="Next: Deployment" rel=next> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> Deployment </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2023 - AI Singapore </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://twitter.com/aisingapore target=_blank rel=noopener title=twitter.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg> </a> <a href=https://www.linkedin.com/company/aisingapore target=_blank rel=noopener title=www.linkedin.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg> </a> <a href=https://www.instagram.com/ai_singapore/ target=_blank rel=noopener title=www.instagram.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M224.1 141c-63.6 0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141zm0 189.6c-41.1 0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.6 74.7-74.7 74.7zm146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9 0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8zm76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8zM398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["navigation.footer", "navigation.tabs", "navigation.top", "toc.follow", "content.tabs.link"], "search": "../../assets/javascripts/workers/search.dfff1995.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script> <script src=../../assets/javascripts/bundle.78eede0e.min.js></script> <script src=../../termynal.js></script> </body> </html>